
Объект изучения — архитектура и программирование встроенных систем

Компьютеры можно классифицировать по размеру и производительности:

- Небольшие компьютеры основаны на микроконтроллерах или микропроцессорах
- Персональные компьютеры
- Серверы и рабочие станции
- Мэйнфреймы
- Суперкомпьютеры

  

Первое поколение компутеров (1940 - 1950)

ЭВМ EDSAC ENIAC

Электронные лампы и реле (20 тыс)

5-30 тыс арифметических оп/с

Второе поколение компутеров (1958 - 1964)

Полупроводникове транзисторы и диоды

1 транзистор способен был заменить 40 электронных ламп и работает с большей скоростью

Третье поколение компутеров (1960 - 1970)

Элементная база на интегральных схемах

Тонкая германиебая …

Четвертое поколение компутеров (1970 -1990)

Большие и сверхбольшие интегральные схемы

Десятки, сотни тысяч и миллионы транзисторов на одном кристалле

  

Встроенной системой можно считать любую вычислительную систему, которая не является пк портативным компьютером (laрtор] или большим универсальным мкомпьютером (mainframe computer).

Устройство, которое включает в себя программируемый компьютер, но не является при этом компьютером общего назначения.

Встроенная вычислительная система-практически любая вычислительная система, неявляющаяся настольным компьютером.

Система обработкиинформации, встроенная в какой-либо продукт.

  

Характеристики встроенных систем:

- Сложный набор функций и многозадачность
- Работа в режиме реального времени
- Низкая стоимость производства
- Низкое знергопотребление
- Ограничение объема памяти
- Интерфейс пользователя и сопряжения с объектом для программирования
- Миниатюризация размеров и процесс тестирования

  

Области применения встроенных систем

- измерительная техника и приборостроение
- медицина
- авиация
- промышленное оборудование
- транспорт
- мобильные и портативные устройства
- торговое оборудование
- робототехника
- системы связи
- бытовая электроника

  

STM32 — широкий ряд микроконтроллеров разделенный на несколько семейств, со своими преимуществами. Начали производство в 2007. Все микроконтроллеры STM32 имеют ядро cortex-M. Состоит из ядра ЦПУ, статического ОЗУ, флеш памяти, интерфейса отладки и других переферийных устройств. Иногда бывают дополнительные типы памяти (внешней или постоянной).

Используется для того что бы попробовать какого это и для прототипирования.

Сверху отладочная плата, ее можно отломать, кнопка связана с первой лабой, там же светодиод

Таргет MCU - это сам контроллер

LSE, HSE - генераторы тактирования

  

Поддерживает Ethernet и порт LAN(или VLAN)

Состоит из двух частей представляющий встроенный отладчик ST-LINK, и непосредственно самого контроллера. Отладчик используется для загрузки программы в микроконтроллер и его отладки.

ST-LINK предоставляет ком порт который можно использовать для обмена данными с хостом пк. Можно записывать и читать с микроконтроллера. Так же предоставляет доп интерфейс SYD, два разъема.

  

Установка инструментария (набор программ и компиляторов)

Используется кроссплатформенный компилятор GCC

  

STM32 Имя файла: srclmain.c Отладочная плата. Сгенерированный СubеMХ код

```
int main(void){
	/* USER CODE BEGIN 1 */
	/* USER CODE END 1 */
	HAL_Init();
	SystemClock_Config();
	MX_GPIO_Init();
	/* USER CODE BEGIN 2 */
	/* USER CODE END 2 */
	/* USER CODE BEGIN WHILE */
	while (1)
	{
		/* USER CODE END WHILE */
		/* USER CODE BEGIN 3 */
	}
	/* USER CODE END 3 */
}

void SystemClock_Config(void)
{
```

HAL_Init - функция инициализироваания тактирования ядра, сброс всей перифирии

MX_GPIO_Init - инициализация всех сконфигурированной перифирии (GPU init)

SystemClock_Config - инициализицаия системного тактового сигнала

  

главный цикл обработки мусора

Отладочная плата. Сгенерированный СubeMX код

Имя файла: src/main.c

Нажал на кнопку - мигнут светодиод.

```
while (1) {
	if (HAL_GPIO_ReadPin(B1_GPIO_Port, B1_Pin) == GPIO_PIN_RESET) {
	while(1) {
		HAL_GPIO_TogglePin(LD2_GPIO_Port, LD2_Pin);	
		HAL_Delay(500);
	}
}
```

  

Архитектура STM32

![[20230901_182239.jpg]]

Cortext-M3 — ядро микропроцессора ARM

DMA — контроллер прямого доступа к памяти, технология позволяющая обмениваться данными без участия ядра, работает за счет того что контроллер подключен напрямую к шине матрицы, имет доступ ко всей памяти, включая память на которую отображены управляющие регистры переферии. Данный контроллер не зависим от ядра. (у 1 - 7 каналов, у 2 - 5 каналов)

Шинная матрица — для того что бы происходили взаимодействия минуя ядро, пачка интерфейсов, которые переключают шину.

Шина ICode — для выборки инструкций и векторов прерываний,

Шина DCode — для выборки записей данных и отладочного доступа

System — для выборки инструкций и векторов прерываний и для выполнения инструкций и управления внутренними компонентами микроконтроллера

Flash — флеш память

Все шины размерности 32 бита

Clock — управление системными часами, таймеров системного времени

SRAM — блок оперативной памяти для выполнения программ (20 кб в среднем)

Reset — блок сброса

AHB — расширенная высокопроизводительная шина (дословный перевод)

Bridge — мосты преобразователи в 2 APB расширенные переферийные шины. Одна работает в 2 раза медленные чем другая.

Мастером (slave/master) в данной архитектуре является cortex, может быть DMA1 или DMA2, Ethernet

Слейв это Flash, SRAM, AHB, 2 APB

  

![[20230906_164905.jpg]]

Итерфейсы JTAG/SW — интерфейсы отладки

КВВП — контроллер встроенных вложенных прерываний, очень много прерываний поддерживает (что то около 256 -16)

Таймер Systic — заводит весь механизм, определяет такты

Размер флеш памяти зависит от вида контроллера, чего то больше, другого будет меньше.

20 байт регистров с резервным питанием — при выключении сохраняют свои значения, батарейки хватает на всю жизнь

Интерфейс внешней памяти — добавить памяти

![[20230915_175543.jpg]]

![[IMG_4138.jpeg]]

![[IMG_4193.jpeg]]

![[IMG_4194.heic]]

![[image.jpg]]

![[image 1.jpg]]

![[image 2.jpg]]

![[image 3.jpg]]

![[image 4.jpg]]

![[image 5.jpg]]

![[image 6.jpg]]

![[image 7.jpg]]

  

  

  

Режимы загрузки:

- Flash память
- внутренне статическое ОЗУ
- системная память

  

Потребность изменения загрузки возникает когда мы обновляем ПО по усант или по внешней памяти

Есть режимы загрузки

![[20231103_173604.jpg]]

  

### Процессор ARM Cortex-M3

![[20231103_173758.jpg]]

![[20231103_175250.jpg]]

  

> Что внутри процессора. Одним словом. “Набор инструкций”

  

Ядро обрабатывает инструкций совершая манипуляцию над данными.

Вычисления ядра — логическик вычисления, работа со структурами, математические операции.

Большинство инстуркций выполняется за один такт.

Контроллер вложенных прерыванию.

Для обработки быстрых событий может потребоватся приостановка процессов основной программы, но в свою очередь прерывания могут быть прерваны прерываниями более приоритетными.

Шинная матрица (бас матрикс) — матрица к которой подключено множество шин процессора, обеспечивает возможность с несколькими шинами одновременно. Модуль шинной матрицы является главной частью системы кортекс м3. Нужна для обеспечения комутации шин миную ядро.

![[20231103_183737.jpg]]

  

### Ядро процессора Cortex-M3

![[20231106_190813.jpg]]

  

Раздельно шина данных, раздельно шина команд, 32 битное цпу, встроенная трассировочная ячейка. Одна из крутейший штук, для процессора.

  

![[20231106_192602.jpg]]

В состав ядра входит блок выборки инструкций, 32 битное алу с дополнительными блоками деления и умножения, дишифратор инструкций, логика управления, набор регистров общего назначения, регистровый файл и блоки связи с кввп и регистами отладки.

Конвейер ядра

![[20231106_193233.jpg]]

Большинство инструкций может выполнятся за один цикл. 3-ступенчетый комвейер

3 уровневая предвыборка.

Поддерживает предсказание переходов, для оптимизаций количества перезагрузок.

Cortex M3 программная модель

![[20231106_194333.jpg]]

Программная деятельность кортекса сосредоточена на регистровом файле.

Кортекс содержит регистровый файл ЦПН из 16 32 битных регистров. R0-R15.

R13 — указатель стека, банковый, и дает возможность работать в двух режимах, каждый из которых использует свое собственное пространство стека, это используется ос реального времени, они имеют название: стек мейн и стек процесса.

R14 — регистр связи, использует для хранения адреса возврата из подпрограммы, благодаря этому регистру кортекс быстро переходит к подпрограмме и выходит из него

R15 — счетчик команд

  

В процессоре так же имеется нескольско регистров специального назначерния

![[20231106_195529.jpg]]

1. значения полей влияющих на значения выполнения инсрукций (флаги). Статус приклодной программы, статус исполнения
    1. n - отрицательный результа
    2. z - нулевой результат
    3. c - перенос результата
    4. v - переполнение результата
2. запрещает все прерывания, за исключением немаскируемых
3. запрещает все прерывания, за исключением немаскируемых
4. запрещает все прерывания, имеющие уровень приоритета, равный или меньше заданного
5. уровень доступа и используемый указатель стека

  

Режимы работы ЦПУ

![[20231106_200411.jpg]]

![[20231106_200921.jpg]]

  

![[20231106_201726.jpg]]

![[IMG_4321.jpeg]]

  

> Кто присутствовал на формуле1?  
> Я присутствовал

  

![[20231110_173945.jpg]]